import 'dotenv/config';
import { GoogleGenerativeAI } from "@google/generative-ai";

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è API
const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);

export async function summarize(text) {
  if (!text) {
    throw new Error("–¢–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞ –ø—É—Å—Ç –∏–ª–∏ –Ω–µ –ø–æ–ª—É—á–µ–Ω.");
  }
  try {
    const model = genAI.getGenerativeModel({ model: "gemini-2.5-flash-lite" });

    const prompt = `
      –¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –≤–∏–¥–µ–æ –∏ —Å–¥–µ–ª–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç –Ω–∞ –†–£–°–°–ö–û–ú —è–∑—ã–∫–µ.
      
      –í –æ—Ç—á–µ—Ç–µ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã:
      
      1. üìà –£–ü–û–ú–Ø–ù–£–¢–´–ï –ê–ö–¢–ò–í–´ (–ê–ö–¶–ò–ò, –ö–†–ò–ü–¢–û):
         - –°–æ—Å—Ç–∞–≤—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–ø–∞–Ω–∏–π –∏ —Ç–∏–∫–µ—Ä–æ–≤, –æ –∫–æ—Ç–æ—Ä—ã—Ö –∏–¥–µ—Ç —Ä–µ—á—å.
         - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–∫—Ç–∏–≤–∞ –Ω–∞–ø–∏—à–∏: –ø—Ä–æ–≥–Ω–æ–∑ –∞–≤—Ç–æ—Ä–∞ (–í–≤–µ—Ä—Ö/–í–Ω–∏–∑/–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ) –∏ –∫—Ä–∞—Ç–∫—É—é –ø—Ä–∏—á–∏–Ω—É.
      
      2. üí° –ö–õ–Æ–ß–ï–í–´–ï –¢–ï–ó–ò–°–´:
         - –í—ã–¥–µ–ª–∏ 3-5 –≥–ª–∞–≤–Ω—ã—Ö –º—ã—Å–ª–µ–π –∞–≤—Ç–æ—Ä–∞. –û —á–µ–º —ç—Ç–æ –≤–∏–¥–µ–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ?
      
      3. ‚ö†Ô∏è –†–ò–°–ö–ò –ò –í–û–ó–ú–û–ñ–ù–û–°–¢–ò:
         - –ö–∞–∫–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–≥—Ä–æ–∑—ã –¥–ª—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤ —É–ø–æ–º–∏–Ω–∞–µ—Ç –∞–≤—Ç–æ—Ä?
         - –ö–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –æ–Ω –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç—å?
      
      4. üéØ –¶–ï–õ–ï–í–´–ï –¶–ï–ù–´ –ò –¶–ò–§–†–´:
         - –£–∫–∞–∂–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã, —É—Ä–æ–≤–Ω–∏ —Ü–µ–Ω –∏–ª–∏ —Å—Ä–æ–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å.

      –¢–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞:
      ---
      ${text.slice(0, 30000)} 
      ---
      –ü–∏—à–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ, –Ω–æ —Å—Ç–∞—Ä–∞–π—Å—è —É–ª–æ–∂–∏—Ç—å—Å—è –≤ 5000-7000 —Å–∏–º–≤–æ–ª–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–π –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –∞–∫—Ç–∏–≤–æ–≤.
    `;

    console.log("ü§ñ Gemini –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–µ—Ç–∞–ª–∏...");
    const result = await model.generateContent(prompt);
    const response = await result.response;
    return response.text();

  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –≤ gemini.js:', error.message);
    throw error;
  }
}